<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Bicycle Management System</title>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1"></script>

    <style>
        /* Previous CSS styles remain the same */
        
        /* Additional styles for new features */
        .arrival-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .bicycle-request {
            background-color: #f8fafc;
            border-radius: 4px;
            padding: 0.5rem;
            margin: 0.5rem 0;
        }

        .bicycle-assignment {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin: 0.25rem 0;
        }

        .bicycle-type-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .bicycle-type-adult {
            background-color: #e3f2fd;
            color: #1e88e5;
        }

        .bicycle-type-child {
            background-color: #e8f5e9;
            color: #43a047;
        }

        .special-request {
            background-color: #fff3e0;
            border-left: 3px solid #ff9800;
            padding: 0.5rem;
            margin: 0.5rem 0;
            font-size: 0.875rem;
        }

        /* PDF viewer styles */
        .pdf-viewer {
            border: 1px solid #ddd;
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .pdf-viewer canvas {
            margin: 0 auto;
            max-width: 100%;
            height: auto;
        }

        .pdf-controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        /* Notification enhancements */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem;
            border-radius: 8px;
            color: white;
            max-width: 300px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading spinner enhancement */
        .loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid #f3f3f3;
            border-radius: 50%;
            border-top: 3px solid #3498db;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Hotel Bicycle Management System</h1>
    </div>

    <div id="todayDepartures" class="departure-notice" style="display: none;">
        <h3>Today's Departures:</h3>
        <div id="departuresList"></div>
    </div>

    <div class="tab-container no-print">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('issuing')">Bicycle Issuing</button>
            <button class="tab-button" onclick="showTab('faulty')">Faulty Bicycles</button>
            <button class="tab-button" onclick="showTab('arrival')">Arrival Preparation</button>
            <button class="tab-button" onclick="showTab('inventory')">Inventory</button>
        </div>
    </div>

    <!-- Previous tab content remains the same -->

    <!-- New Arrival Preparation Tab -->
    <div id="arrivalTab" class="tab-content">
        <div id="arrival-preparation-root"></div>
    </div>

    <!-- New Inventory Tab -->
    <div id="inventoryTab" class="tab-content">
        <div id="inventory-management-root"></div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification" style="display: none;"></div>

<script>
// Firebase Configuration
const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Global state
let records = [];
let faultyBicycles = [];
let arrivalRequests = [];
let bicycleInventory = [];

// ==================
// PDF PROCESSING
// ==================

async function processPDF(file) {
    try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let extractedText = '';

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            extractedText += textContent.items.map(item => item.str).join(' ');
        }

        return extractBicycleRequests(extractedText);
    } catch (error) {
        console.error('Error processing PDF:', error);
        throw new Error('Failed to process PDF file');
    }
}

function extractBicycleRequests(text) {
    const requests = [];
    const roomPattern = /Room\s*(\d+)/gi;
    const guestPattern = /Guest:\s*([^\n]+)/gi;
    const datePattern = /(\d{2}\/\d{2}\/\d{4})/g;
    const bicyclePattern = /Bicycles:\s*Adults:\s*(\d+)\s*Children:\s*(\d+)/gi;
    const specialPattern = /Special Requirements:\s*([^\n]+)/gi;

    let match;
    while ((match = roomPattern.exec(text)) !== null) {
        const roomNumber = match[1];
        const guestMatch = guestPattern.exec(text);
        const dates = text.match(datePattern);
        const bicycleMatch = bicyclePattern.exec(text);
        const specialMatch = specialPattern.exec(text);

        if (guestMatch && dates && bicycleMatch) {
            requests.push({
                id: Date.now() + requests.length,
                roomNumber,
                guestName: guestMatch[1],
                arrivalDate: dates[0],
                departureDate: dates[1],
                bicycleRequest: {
                    adults: parseInt(bicycleMatch[1]),
                    children: parseInt(bicycleMatch[2]),
                    special: specialMatch ? specialMatch[1] : ''
                },
                assignedBicycles: [],
                status: 'Pending'
            });
        }
    }

    return requests;
}

// ==================
// INVENTORY MANAGEMENT
// ==================

class BicycleInventory {
    constructor() {
        this.bicycles = new Map();
    }

    addBicycle(number, type, status = 'Available') {
        this.bicycles.set(number, { type, status, maintenanceHistory: [] });
    }

    removeBicycle(number) {
        this.bicycles.delete(number);
    }

    updateStatus(number, status) {
        if (this.bicycles.has(number)) {
            const bicycle = this.bicycles.get(number);
            bicycle.status = status;
            this.bicycles.set(number, bicycle);
        }
    }

    addMaintenanceRecord(number, record) {
        if (this.bicycles.has(number)) {
            const bicycle = this.bicycles.get(number);
            bicycle.maintenanceHistory.push({
                date: new Date(),
                ...record
            });
            this.bicycles.set(number, bicycle);
        }
    }

    getAvailableBicycles(type = 'all') {
        return Array.from(this.bicycles.entries())
            .filter(([_, bike]) => 
                bike.status === 'Available' &&
                (type === 'all' || bike.type === type)
            )
            .map(([number]) => number);
    }
}

// Initialize inventory
const inventory = new BicycleInventory();

// ==================
// DATABASE OPERATIONS
// ==================

function saveArrivalRequest(request) {
    return db.collection('arrivalRequests').add(request);
}

function updateArrivalRequest(id, updates) {
    return db.collection('arrivalRequests').doc(id).update(updates);
}

function loadArrivalRequests() {
    return db.collection('arrivalRequests')
        .where('arrivalDate', '>=', new Date().toISOString().split('T')[0])
        .orderBy('arrivalDate')
        .get()
        .then(snapshot => {
            arrivalRequests = [];
            snapshot.forEach(doc => {
                arrivalRequests.push({ id: doc.id, ...doc.data() });
            });
            return arrivalRequests;
        });
}

// ==================
// REACT COMPONENTS
// ==================

// ArrivalPreparation Component
const ArrivalPreparation = () => {
    // ... Previous React component code ...
};

// InventoryManagement Component
const InventoryManagement = () => {
    // ... Previous React component code ...
};

// ==================
// INITIALIZATION
// ==================

document.addEventListener('DOMContentLoaded', () => {
    // Initialize PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';

    // Initialize React components
    const arrivalRoot = ReactDOM.createRoot(document.getElementById('arrival-preparation-root'));
    arrivalRoot.render(React.createElement(ArrivalPreparation));

    const inventoryRoot = ReactDOM.createRoot(document.getElementById('inventory-management-root'));
    inventoryRoot.render(React.createElement(InventoryManagement));

    // Load initial data
    Promise.all([
        loadRecords(),
        loadFaultyBicycles(),
        loadArrivalRequests()
    ]).then(() => {
        showNotification('System initialized successfully');
    }).catch(error => {
        console.error('Error initializing system:', error);
        showNotification('Error initializing system', 'error');
    });
});

// ==================
// EVENT HANDLERS
// ==================

// ... Previous event handlers ...

// New event handlers for bicycle inventory
function handleBicycleAssignment(requestId, bicycleNumber) {
    const request = arrivalRequests.find(r => r.id === requestId);
    if (request && inventory.getAvailableBicycles().includes(bicycleNumber)) {
        inventory.updateStatus(bicycleNumber, 'Reserved');
        updateArrivalRequest(requestId, {
            assignedBicycles: [...request.assignedBicycles, bicycleNumber]
        });
    }
}

// ==================
// UTILITY FUNCTIONS
// ==================

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
    notification.style.display = 'block';
    setTimeout(() => {
        notification.style.display = 'none';
    }, 5000);
}

// ... Other utility functions ...

</script>
</body>
</html>
