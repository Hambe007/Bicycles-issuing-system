
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Bicycle Management System</title>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1"></script>

    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBjAGc8L0bkO_2RbWi0-rw7__lSHCoBrJQ",
            authDomain: "bicycle-issuing-system2.firebaseapp.com",
            projectId: "bicycle-issuing-system2",
            storageBucket: "bicycle-issuing-system2.firebasestorage.app",
            messagingSenderId: "64926990610",
            appId: "1:64926990610:web:f45390888ea1d0dfb5f3cb"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Test Firebase connection
        async function testFirebaseConnection() {
            try {
                await db.collection('test').add({
                    test: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Firebase connection successful');
                return true;
            } catch (error) {
                console.error('Firebase connection error:', error);
                return false;
            }
        }
    </script>
</head>
<style>
    /* Base Styles */
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        background-color: #f5f6fa;
    }

    .header {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
    }

    /* Tab Styles */
    .tab-container { margin-bottom: 20px; }
    .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    .tab-button {
        padding: 10px 20px;
        background-color: #f0f0f0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .tab-button.active {
        background-color: #4CAF50;
        color: white;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Form Styles */
    .form-section {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    textarea,
    select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }

    /* Button Styles */
    button {
        padding: 8px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    .print-btn { background-color: #2196F3; }
    .edit-btn { background-color: #ff9800; }
    .delete-btn { background-color: #f44336; }
    .return-btn { background-color: #4CAF50; }

    /* Table Styles */
    table {
        width: 100%;
        border-collapse: collapse;
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    th {
        background-color: #4CAF50;
        color: white;
    }

    /* Status Indicators */
    .status-returned { color: #888; font-style: italic; }
    .priority-high {
        background-color: #ffebee;
        border-left: 4px solid #f44336;
    }
    .priority-medium {
        background-color: #fff3e0;
        border-left: 4px solid #ff9800;
    }
    .priority-low {
        background-color: #e8f5e9;
        border-left: 4px solid #4caf50;
    }

    /* Upload Area */
    .pdf-upload {
        border: 2px dashed #ddd;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
        background-color: #fafafa;
        margin-bottom: 20px;
    }

    /* Notifications */
    .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px;
        color: white;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        display: none;
        z-index: 1000;
    }

    /* Loading States */
    .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .tab-buttons { flex-direction: column; }
        .form-grid { grid-template-columns: 1fr; }
        .pdf-upload { padding: 10px; }
    }

    @media print {
        .no-print { display: none !important; }
        body { padding: 0; background: white; }
        table { box-shadow: none; }
    }
</style>
<body>
    <div class="header">
        <h1>Hotel Bicycle Management System</h1>
    </div>

    <div id="todayDepartures" class="departure-notice" style="display: none;">
        <h3>Today's Departures:</h3>
        <div id="departuresList"></div>
    </div>

    <div class="tab-container no-print">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('issuing')">Bicycle Issuing</button>
            <button class="tab-button" onclick="showTab('faulty')">Faulty Bicycles</button>
            <button class="tab-button" onclick="showTab('arrival')">Arrival Preparation</button>
        </div>
    </div>

    <!-- Bicycle Issuing Tab -->
    <div id="issuingTab" class="tab-content active">
        <div class="search-section no-print">
            <div class="search-group">
                <input type="text" id="bicycleSearch" placeholder="Search by Bicycle Number...">
                <button onclick="searchByBicycle()">Search Bicycle</button>
            </div>
            <div class="search-group">
                <input type="text" id="roomSearch" placeholder="Search by Room Number...">
                <button onclick="searchByRoom()">Search Room</button>
            </div>
            <div class="search-group">
                <button onclick="resetSearch()">Reset Search</button>
                <button class="print-btn" onclick="printDepartures()">Print Today's Departures</button>
                <button class="print-btn" onclick="printRecords()">Print Records</button>
            </div>
        </div>

        <form id="bicycleForm" class="form-section no-print">
            <h2>Issue Bicycle</h2>
            <input type="hidden" id="editIndex">
            
            <div class="form-grid">
                <div>
                    <label for="roomNumber">Room Number:</label>
                    <input type="text" id="roomNumber" required>
                </div>
                
                <div>
                    <label for="guestName">Guest Name:</label>
                    <input type="text" id="guestName" required>
                </div>
                
                <div>
                    <label for="issueDate">Date of Issue:</label>
                    <input type="date" id="issueDate" required>
                </div>
                
                <div>
                    <label for="departureDate">Date of Departure:</label>
                    <input type="date" id="departureDate" required>
                </div>
                
                <div>
                    <label for="bicycleNumber">Bicycle Number:</label>
                    <input type="text" id="bicycleNumber" required>
                </div>
            </div>
            
            <button type="submit">Save Record</button>
        </form>

        <table id="recordsTable">
            <thead>
                <tr>
                    <th>Room Number</th>
                    <th>Guest Name</th>
                    <th>Issue Date</th>
                    <th>Departure Date</th>
                    <th>Bicycle Number</th>
                    <th>Status</th>
                    <th class="no-print">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Faulty Bicycles Tab -->
    <div id="faultyTab" class="tab-content">
        <div class="search-section no-print">
            <div class="search-group">
                <input type="text" id="faultyBicycleSearch" placeholder="Search faulty bicycle number...">
                <button onclick="searchFaultyBicycle()">Search</button>
            </div>
            <div class="search-group">
                <button onclick="resetFaultySearch()">Reset</button>
                <button class="print-btn" onclick="printFaultyBicycles()">Print Faulty Bicycles</button>
            </div>
        </div>

        <form id="faultyBicycleForm" class="form-section no-print">
            <h2>Report Faulty Bicycle</h2>
            <input type="hidden" id="faultyEditIndex">
            
            <div class="form-grid">
                <div>
                    <label for="faultyBicycleNumber">Bicycle Number:</label>
                    <input type="text" id="faultyBicycleNumber" required>
                </div>
                
                <div>
                    <label for="issueDescription">Issue Description:</label>
                    <textarea id="issueDescription" required></textarea>
                </div>

                <div>
                    <label for="priority">Priority Level:</label>
                    <select id="priority" required>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
            </div>
            
            <button type="submit">Report Issue</button>
        </form>

        <table id="faultyBicycleTable">
            <thead>
                <tr>
                    <th>Bicycle Number</th>
                    <th>Issue Description</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Reported Date</th>
                    <th class="no-print">Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Arrival Preparation Tab -->
    <div id="arrivalTab" class="tab-content">
        <div id="arrival-preparation-root"></div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>
</body>
<script>
// Global variables
let records = [];
let faultyBicycles = [];

// Utility Functions
function formatDate(dateString) {
    return new Date(dateString).toLocaleDateString();
}

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
    notification.style.display = 'block';
    setTimeout(() => {
        notification.style.display = 'none';
    }, 5000);
}

// Tab Management
function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
    document.getElementById(tabName + 'Tab').classList.add('active');
    document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
}

// Load Records
async function loadRecords() {
    try {
        const snapshot = await db.collection('bicycleRecords')
            .orderBy('timestamp', 'desc')
            .get();
        
        records = [];
        snapshot.forEach(doc => {
            records.push({ id: doc.id, ...doc.data() });
        });
        
        displayRecords();
        checkDepartures();
    } catch (error) {
        console.error('Error loading records:', error);
        showNotification('Error loading records', 'error');
    }
}

// Load Faulty Bicycles
async function loadFaultyBicycles() {
    try {
        const snapshot = await db.collection('faultyBicycles')
            .orderBy('timestamp', 'desc')
            .get();
        
        faultyBicycles = [];
        snapshot.forEach(doc => {
            faultyBicycles.push({ id: doc.id, ...doc.data() });
        });
        
        displayFaultyBicycles();
    } catch (error) {
        console.error('Error loading faulty bicycles:', error);
        showNotification('Error loading faulty bicycles', 'error');
    }
}

// Display Records
function displayRecords(recordsToShow = records) {
    const table = document.querySelector('#recordsTable tbody');
    if (!table) return;

    table.innerHTML = recordsToShow.map(record => `
        <tr>
            <td>${record.roomNumber}</td>
            <td>${record.guestName}</td>
            <td>${formatDate(record.issueDate)}</td>
            <td>${formatDate(record.departureDate)}</td>
            <td>${record.bicycleNumber}</td>
            <td class="${record.status === 'Returned' ? 'status-returned' : ''}">${record.status || 'Active'}</td>
            <td class="no-print">
                ${record.status !== 'Returned' ? `
                    <button class="edit-btn" onclick="editRecord('${record.id}')">Edit</button>
                    <button class="return-btn" onclick="markAsReturned('${record.id}')">Return</button>
                    <button class="delete-btn" onclick="deleteRecord('${record.id}')">Delete</button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

// Initialize when document is ready
document.addEventListener('DOMContentLoaded', () => {
    // Test Firebase connection
    testFirebaseConnection().then(connected => {
        if (connected) {
            // Load initial data
            loadRecords();
            loadFaultyBicycles();
            
            // Set today's date as default for issue date
            const issueDateInput = document.getElementById('issueDate');
            if (issueDateInput) {
                issueDateInput.valueAsDate = new Date();
            }
        } else {
            showNotification('Failed to connect to Firebase', 'error');
        }
    });
});

// Form Submissions
document.getElementById('bicycleForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const record = {
        roomNumber: document.getElementById('roomNumber').value,
        guestName: document.getElementById('guestName').value,
        issueDate: document.getElementById('issueDate').value,
        departureDate: document.getElementById('departureDate').value,
        bicycleNumber: document.getElementById('bicycleNumber').value,
        status: 'Active',
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
        await db.collection('bicycleRecords').add(record);
        showNotification('Record added successfully');
        e.target.reset();
        loadRecords();
    } catch (error) {
        console.error('Error adding record:', error);
        showNotification('Error adding record', 'error');
    }
});

// More functions in the next section...
</script>
<script>
// Edit Record
async function editRecord(id) {
    const record = records.find(r => r.id === id);
    if (!record) return;

    document.getElementById('roomNumber').value = record.roomNumber;
    document.getElementById('guestName').value = record.guestName;
    document.getElementById('issueDate').value = record.issueDate;
    document.getElementById('departureDate').value = record.departureDate;
    document.getElementById('bicycleNumber').value = record.bicycleNumber;
    document.getElementById('editIndex').value = id;
}

// Mark as Returned
async function markAsReturned(id) {
    if (!confirm('Mark this bicycle as returned?')) return;

    try {
        await db.collection('bicycleRecords').doc(id).update({
            status: 'Returned',
            returnDate: new Date().toISOString()
        });
        showNotification('Bicycle marked as returned');
        loadRecords();
    } catch (error) {
        console.error('Error marking as returned:', error);
        showNotification('Error updating record', 'error');
    }
}

// Delete Record
async function deleteRecord(id) {
    if (!confirm('Are you sure you want to delete this record?')) return;

    try {
        await db.collection('bicycleRecords').doc(id).delete();
        showNotification('Record deleted successfully');
        loadRecords();
    } catch (error) {
        console.error('Error deleting record:', error);
        showNotification('Error deleting record', 'error');
    }
}

// Search Functions
function searchByBicycle() {
    const searchTerm = document.getElementById('bicycleSearch').value.toLowerCase();
    if (!searchTerm) {
        showNotification('Please enter a bicycle number', 'error');
        return;
    }
    const filtered = records.filter(record => 
        record.bicycleNumber.toLowerCase().includes(searchTerm)
    );
    displayRecords(filtered);
}

function searchByRoom() {
    const searchTerm = document.getElementById('roomSearch').value.toLowerCase();
    if (!searchTerm) {
        showNotification('Please enter a room number', 'error');
        return;
    }
    const filtered = records.filter(record => 
        record.roomNumber.toLowerCase().includes(searchTerm)
    );
    displayRecords(filtered);
}

function resetSearch() {
    document.getElementById('bicycleSearch').value = '';
    document.getElementById('roomSearch').value = '';
    displayRecords();
}

// Print Functions
function printDepartures() {
    const today = new Date().toLocaleDateString();
    const departingToday = records.filter(record => 
        record.departureDate === new Date().toISOString().split('T')[0] && 
        record.status !== 'Returned'
    );

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Today's Departures - ${today}</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f5f5f5; }
            </style>
        </head>
        <body>
            <h1>Today's Bicycle Departures - ${today}</h1>
            <table>
                <thead>
                    <tr>
                        <th>Room</th>
                        <th>Guest Name</th>
                        <th>Bicycle #</th>
                        <th>Issue Date</th>
                    </tr>
                </thead>
                <tbody>
                    ${departingToday.map(record => `
                        <tr>
                            <td>${record.roomNumber}</td>
                            <td>${record.guestName}</td>
                            <td>${record.bicycleNumber}</td>
                            <td>${formatDate(record.issueDate)}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

function printRecords() {
    const today = new Date().toLocaleDateString();
    const activeRecords = records.filter(record => record.status !== 'Returned');

    const printWindow = window.open('', '_blank');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Active Bicycle Records - ${today}</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 20px; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background-color: #f5f5f5; }
            </style>
        </head>
        <body>
            <h1>Active Bicycle Records - ${today}</h1>
            <table>
                <thead>
                    <tr>
                        <th>Room Number</th>
                        <th>Guest Name</th>
                        <th>Issue Date</th>
                        <th>Departure Date</th>
                        <th>Bicycle Number</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    ${activeRecords.map(record => `
                        <tr>
                            <td>${record.roomNumber}</td>
                            <td>${record.guestName}</td>
                            <td>${formatDate(record.issueDate)}</td>
                            <td>${formatDate(record.departureDate)}</td>
                            <td>${record.bicycleNumber}</td>
                            <td>${record.status || 'Active'}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}
</script>
<script>
// Display Faulty Bicycles
function displayFaultyBicycles(bicyclesToShow = faultyBicycles) {
    const table = document.querySelector('#faultyBicycleTable tbody');
    if (!table) return;

    table.innerHTML = bicyclesToShow.map(bicycle => `
        <tr class="priority-${bicycle.priority}">
            <td>${bicycle.bicycleNumber}</td>
            <td>${bicycle.issueDescription}</td>
            <td>${bicycle.priority.toUpperCase()}</td>
            <td>${bicycle.status}</td>
            <td>${formatDate(bicycle.reportedDate)}</td>
            <td class="no-print">
                ${bicycle.status !== 'Fixed' ? `
                    <button class="edit-btn" onclick="editFaultyBicycle('${bicycle.id}')">Edit</button>
                    <button class="return-btn" onclick="markAsFixed('${bicycle.id}')">Mark Fixed</button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

// Handle Faulty Bicycle Form
document.getElementById('faultyBicycleForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const faultyBicycle = {
        bicycleNumber: document.getElementById('faultyBicycleNumber').value,
        issueDescription: document.getElementById('issueDescription').value,
        priority: document.getElementById('priority').value,
        status: 'Under Repair',
        reportedDate: new Date().toISOString(),
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };

    const editId = document.getElementById('faultyEditIndex').value;

    try {
        if (editId) {
            await db.collection('faultyBicycles').doc(editId).update(faultyBicycle);
            showNotification('Faulty bicycle record updated');
        } else {
            await db.collection('faultyBicycles').add(faultyBicycle);
            showNotification('Faulty bicycle reported successfully');
        }
        e.target.reset();
        document.getElementById('faultyEditIndex').value = '';
        loadFaultyBicycles();
    } catch (error) {
        console.error('Error with faulty bicycle:', error);
        showNotification('Error processing faulty bicycle record', 'error');
    }
});

// Edit Faulty Bicycle
function editFaultyBicycle(id) {
    const bicycle = faultyBicycles.find(b => b.id === id);
    if (!bicycle) return;

    document.getElementById('faultyBicycleNumber').value = bicycle.bicycleNumber;
    document.getElementById('issueDescription').value = bicycle.issueDescription;
    document.getElementById('priority').value = bicycle.priority;
    document.getElementById('faultyEditIndex').value = id;
}

// Mark as Fixed
async function markAsFixed(id) {
    if (!confirm('Mark this bicycle as fixed?')) return;

    try {
        await db.collection('faultyBicycles').doc(id).update({
            status: 'Fixed',
            fixedDate: new Date().toISOString()
        });
        showNotification('Bicycle marked as fixed');
        loadFaultyBicycles();
    } catch (error) {
        console.error('Error marking as fixed:', error);
        showNotification('Error updating bicycle status', 'error');
    }
}

// Search Faulty Bicycles
function searchFaultyBicycle() {
    const searchTerm = document.getElementById('faultyBicycleSearch').value.toLowerCase();
    if (!searchTerm) {
        showNotification('Please enter a bicycle number', 'error');
        return;
    }
    const filtered = faultyBicycles.filter(bicycle => 
        bicycle.bicycleNumber.toLowerCase().includes(searchTerm)
    );
    displayFaultyBicycles(filtered);
}

function resetFaultySearch() {
    document.getElementById('faultyBicycleSearch').value = '';
    displayFaultyBicycles();
}
</script>
<script>
// PDF Processing Utilities
const PDFProcessor = {
    async extractText(file) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        let extractedText = '';
        
        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            extractedText += textContent.items.map(item => item.str).join(' ');
        }
        
        return extractedText;
    },

    parseArrivalData(text) {
        const arrivals = [];
        
        // Regular expressions for data extraction
        const patterns = {
            roomMatch: /Room\s*(\d+)/gi,
            guestMatch: /Guest[:\s]+([^,\n]+)/gi,
            dateMatch: /(\d{2}[-/]\d{2}[-/]\d{4})/g,
            bicycleMatch: /Bicycles?[:\s]+(\d+)\s*(?:Adult[s]?)?[,\s]*(\d*)\s*(?:Child(?:ren)?)?/gi
        };

        // Split text into sections (one per guest)
        const sections = text.split(/(?=Room\s*\d+)/gi);

        sections.forEach(section => {
            if (!section.trim()) return;

            const roomNumber = (section.match(patterns.roomMatch) || [''])[0].replace(/[^\d]/g, '');
            const guestName = (section.match(patterns.guestMatch) || [''])[0].replace(/Guest[:\s]+/i, '').trim();
            const dates = section.match(patterns.dateMatch) || [];
            const bicycleMatch = patterns.bicycleMatch.exec(section);

            if (roomNumber && guestName && dates.length >= 2) {
                arrivals.push({
                    id: Date.now() + Math.random().toString(36).substr(2, 9),
                    roomNumber,
                    guestName,
                    arrivalDate: this.formatDate(dates[0]),
                    departureDate: this.formatDate(dates[1]),
                    bicycleRequest: {
                        adults: bicycleMatch ? parseInt(bicycleMatch[1]) || 0 : 0,
                        children: bicycleMatch ? parseInt(bicycleMatch[2]) || 0 : 0
                    },
                    status: 'Pending',
                    assignedBicycles: []
                });
            }
        });

        return arrivals;
    },

    formatDate(dateStr) {
        const [day, month, year] = dateStr.split(/[-/]/).map(num => num.padStart(2, '0'));
        return `${year}-${month}-${day}`;
    }
};

// Arrival Preparation Component
const ArrivalPreparation = () => {
    const [arrivals, setArrivals] = React.useState([]);
    const [uploadError, setUploadError] = React.useState('');
    const [isLoading, setIsLoading] = React.useState(false);
    const [statistics, setStatistics] = React.useState({
        totalRequests: 0,
        assigned: 0,
        pending: 0
    });

    React.useEffect(() => {
        loadSavedArrivals();
    }, []);

    const loadSavedArrivals = async () => {
        try {
            const snapshot = await db.collection('arrivalRequests')
                .where('arrivalDate', '>=', new Date().toISOString().split('T')[0])
                .orderBy('arrivalDate')
                .get();

            const loadedArrivals = [];
            snapshot.forEach(doc => {
                loadedArrivals.push({ id: doc.id, ...doc.data() });
            });

            setArrivals(loadedArrivals);
            updateStatistics(loadedArrivals);
        } catch (error) {
            console.error('Error loading arrivals:', error);
            showNotification('Error loading arrival requests', 'error');
        }
    };

    const handleFileUpload = async (event) => {
        const file = event.target.files[0];
        if (!file || file.type !== 'application/pdf') {
            setUploadError('Please upload a PDF file');
            return;
        }

        setIsLoading(true);
        setUploadError('');

        try {
            // Upload to Firebase Storage
            const storageRef = storage.ref();
            const fileRef = storageRef.child(`arrival-reports/${Date.now()}_${file.name}`);
            await fileRef.put(file);
            const downloadURL = await fileRef.getDownloadURL();

            // Process PDF
            const extractedText = await PDFProcessor.extractText(file);
            const parsedArrivals = PDFProcessor.parseArrivalData(extractedText);

            // Store in Firestore
            const batch = db.batch();
            parsedArrivals.forEach(arrival => {
                const docRef = db.collection('arrivalRequests').doc();
                batch.set(docRef, {
                    ...arrival,
                    pdfUrl: downloadURL,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
            });
            await batch.commit();

            setArrivals(prevArrivals => [...prevArrivals, ...parsedArrivals]);
            updateStatistics([...arrivals, ...parsedArrivals]);
            showNotification('Arrival report processed successfully');
        } catch (error) {
            console.error('Error processing PDF:', error);
            setUploadError('Error processing PDF file');
        } finally {
            setIsLoading(false);
        }
    };

    const updateStatistics = (arrivalList) => {
        const stats = arrivalList.reduce((acc, arrival) => {
            const total = arrival.bicycleRequest.adults + arrival.bicycleRequest.children;
            const assigned = arrival.assignedBicycles?.length || 0;
            return {
                totalRequests: acc.totalRequests + total,
                assigned: acc.assigned + assigned,
                pending: acc.pending + (total - assigned)
            };
        }, { totalRequests: 0, assigned: 0, pending: 0 });

        setStatistics(stats);
    };

    const assignBicycle = async (arrivalId, bicycleNumber, index) => {
        if (!bicycleNumber.trim()) return;

        try {
            const arrival = arrivals.find(a => a.id === arrivalId);
            if (!arrival) return;

            const updatedAssignments = [...(arrival.assignedBicycles || [])];
            updatedAssignments[index] = {
                number: bicycleNumber,
                type: index < arrival.bicycleRequest.adults ? 'adult' : 'child'
            };

            await db.collection('arrivalRequests').doc(arrivalId).update({
                assignedBicycles: updatedAssignments,
                status: updatedAssignments.length === 
                    (arrival.bicycleRequest.adults + arrival.bicycleRequest.children) 
                    ? 'Ready' : 'Pending'
            });

            setArrivals(prevArrivals => 
                prevArrivals.map(a => 
                    a.id === arrivalId 
                        ? { ...a, assignedBicycles: updatedAssignments }
                        : a
                )
            );
            updateStatistics(arrivals);
        } catch (error) {
            console.error('Error assigning bicycle:', error);
            showNotification('Error assigning bicycle', 'error');
        }
    };

    return React.createElement('div', { className: 'arrival-preparation' },
        // Upload Section
        React.createElement('div', { className: 'pdf-upload' },
            React.createElement('input', {
                type: 'file',
                accept: '.pdf',
                onChange: handleFileUpload,
                disabled: isLoading
            }),
            uploadError && React.createElement('div', { className: 'error' }, uploadError),
            isLoading && React.createElement('div', { className: 'loading' }, 'Processing...')
        ),

        // Statistics Section
        statistics.totalRequests > 0 && React.createElement('div', { className: 'statistics-grid' },
            React.createElement('div', { className: 'stat-card' },
                React.createElement('h3', null, 'Total Requests'),
                React.createElement('p', null, statistics.totalRequests)
            ),
            React.createElement('div', { className: 'stat-card' },
                React.createElement('h3', null, 'Assigned'),
                React.createElement('p', null, statistics.assigned)
            ),
            React.createElement('div', { className: 'stat-card' },
                React.createElement('h3', null, 'Pending'),
                React.createElement('p', null, statistics.pending)
            )
        ),

        // Arrivals Table
        arrivals.length > 0 && React.createElement('table', null,
            React.createElement('thead', null,
                React.createElement('tr', null,
                    React.createElement('th', null, 'Room'),
                    React.createElement('th', null, 'Guest'),
                    React.createElement('th', null, 'Arrival'),
                    React.createElement('th', null, 'Departure'),
                    React.createElement('th', null, 'Bicycle Requests'),
                    React.createElement('th', null, 'Assignments'),
                    React.createElement('th', null, 'Status')
                )
            ),
            React.createElement('tbody', null,
                arrivals.map(arrival => 
                    React.createElement('tr', { key: arrival.id },
                        React.createElement('td', null, arrival.roomNumber),
                        React.createElement('td', null, arrival.guestName),
                        React.createElement('td', null, arrival.arrivalDate),
                        React.createElement('td', null, arrival.departureDate),
                        React.createElement('td', null, 
                            `Adults: ${arrival.bicycleRequest.adults}, Children: ${arrival.bicycleRequest.children}`
                        ),
                        React.createElement('td', null, 
                            Array.from({ length: arrival.bicycleRequest.adults + arrival.bicycleRequest.children })
                                .map((_, index) => 
                                    React.createElement('input', {
                                        key: index,
                                        type: 'text',
                                        value: arrival.assignedBicycles?.[index]?.number || '',
                                        onChange: (e) => assignBicycle(arrival.id, e.target.value, index),
                                        placeholder: `Bike #${index + 1}`,
                                        className: 'bicycle-input'
                                    })
                                )
                        ),
                        React.createElement('td', null, arrival.status)
                    )
                )
            )
        )
    );
};

// Initialize React components
document.addEventListener('DOMContentLoaded', () => {
    const arrivalRoot = document.getElementById('arrival-preparation-root');
    if (arrivalRoot) {
        ReactDOM.createRoot(arrivalRoot).render(React.createElement(ArrivalPreparation));
    }
});
</script>
</html>
