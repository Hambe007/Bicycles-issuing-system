<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Bicycle Management System</title>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.263.1"></script>

    <!-- Firebase Configuration -->
    <script>
        const firebaseConfig = {
  apiKey: "AIzaSyBjAGc8L0bkO_2RbWi0-rw7__lSHCoBrJQ",
  authDomain: "bicycle-issuing-system2.firebaseapp.com",
  projectId: "bicycle-issuing-system2",
  storageBucket: "bicycle-issuing-system2.firebasestorage.app",
  messagingSenderId: "64926990610",
  appId: "1:64926990610:web:f45390888ea1d0dfb5f3cb"
};

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
    </script>
</head>
<style>
    body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        background-color: #f5f6fa;
    }

    .header {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        text-align: center;
    }

    /* Tab Styles */
    .tab-container { margin-bottom: 20px; }
    .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    .tab-button {
        padding: 10px 20px;
        background-color: #f0f0f0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .tab-button.active {
        background-color: #4CAF50;
        color: white;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Form and Input Styles */
    .form-section {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    input[type="text"],
    input[type="date"],
    input[type="number"],
    textarea,
    select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    /* Button Styles */
    button {
        padding: 8px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    button:hover { opacity: 0.9; }
    .print-btn { background-color: #2196F3; }
    .edit-btn { background-color: #ff9800; }
    .delete-btn { background-color: #f44336; }
    .return-btn { background-color: #4CAF50; }

    /* Table Styles */
    table {
        width: 100%;
        border-collapse: collapse;
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }
    th {
        background-color: #4CAF50;
        color: white;
    }

    /* Status Indicators */
    .priority-high {
        background-color: #ffebee;
        border-left: 4px solid #f44336;
    }
    .priority-medium {
        background-color: #fff3e0;
        border-left: 4px solid #ff9800;
    }
    .priority-low {
        background-color: #e8f5e9;
        border-left: 4px solid #4caf50;
    }

    /* PDF Upload Styles */
    .pdf-upload {
        border: 2px dashed #ddd;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
        background-color: #fafafa;
        margin-bottom: 20px;
    }
    .pdf-preview {
        max-width: 100%;
        margin: 20px 0;
        padding: 10px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    /* Notification Styles */
    .notification {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px;
        color: white;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        display: none;
        z-index: 1000;
    }

    /* Loading Spinner */
    .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .tab-buttons { flex-direction: column; }
        .form-grid { grid-template-columns: 1fr; }
        .pdf-upload { padding: 10px; }
    }

    @media print {
        .no-print { display: none !important; }
        body { padding: 0; background: white; }
        table { box-shadow: none; }
    }
</style>
<body>
    <div class="header">
        <h1>Hotel Bicycle Management System</h1>
    </div>

    <div id="todayDepartures" class="departure-notice" style="display: none;">
        <h3>Today's Departures:</h3>
        <div id="departuresList"></div>
    </div>

    <div class="tab-container no-print">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('issuing')">Bicycle Issuing</button>
            <button class="tab-button" onclick="showTab('faulty')">Faulty Bicycles</button>
            <button class="tab-button" onclick="showTab('arrival')">Arrival Preparation</button>
            <button class="tab-button" onclick="showTab('inventory')">Inventory</button>
        </div>
    </div>

    <!-- Bicycle Issuing Tab -->
    <div id="issuingTab" class="tab-content active">
        <!-- Issuing form and table here -->
    </div>

    <!-- Faulty Bicycles Tab -->
    <div id="faultyTab" class="tab-content">
        <!-- Faulty bicycles form and table here -->
    </div>

    <!-- Arrival Preparation Tab -->
    <div id="arrivalTab" class="tab-content">
        <div id="arrival-preparation-root"></div>
    </div>

    <!-- Inventory Tab -->
    <div id="inventoryTab" class="tab-content">
        <div id="inventory-management-root"></div>
    </div>

    <!-- Notification Container -->
    <div id="notification" class="notification"></div>
</body>
<script>
// Global variables
let records = [];
let faultyBicycles = [];
let arrivalRequests = [];

// Utility Functions
function formatDate(dateString) {
    return new Date(dateString).toLocaleDateString();
}

function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.style.backgroundColor = type === 'success' ? '#4CAF50' : '#f44336';
    notification.style.display = 'block';
    setTimeout(() => {
        notification.style.display = 'none';
    }, 5000);
}

// Tab Management
function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
    document.getElementById(tabName + 'Tab').classList.add('active');
    document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
}

// Firebase Storage Functions
async function uploadPDF(file) {
    const storageRef = storage.ref();
    const fileRef = storageRef.child(`arrival-reports/${Date.now()}_${file.name}`);
    
    try {
        await fileRef.put(file);
        const downloadURL = await fileRef.getDownloadURL();
        return downloadURL;
    } catch (error) {
        console.error('Error uploading file:', error);
        throw error;
    }
}

async function storeRecord(record) {
    try {
        const docRef = await db.collection('bicycleRecords').add({
            ...record,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });
        return docRef.id;
    } catch (error) {
        console.error('Error storing record:', error);
        throw error;
    }
}

// Load Records
async function loadRecords() {
    try {
        const snapshot = await db.collection('bicycleRecords')
            .orderBy('timestamp', 'desc')
            .get();
        
        records = [];
        snapshot.forEach(doc => {
            records.push({ id: doc.id, ...doc.data() });
        });
        
        displayRecords();
        checkDepartures();
    } catch (error) {
        console.error('Error loading records:', error);
        showNotification('Error loading records', 'error');
    }
}

// Display Records
function displayRecords(recordsToShow = records) {
    const table = document.querySelector('#recordsTable tbody');
    if (!table) return;

    table.innerHTML = recordsToShow.map(record => `
        <tr>
            <td>${record.roomNumber}</td>
            <td>${record.guestName}</td>
            <td>${formatDate(record.issueDate)}</td>
            <td>${formatDate(record.departureDate)}</td>
            <td>${record.bicycleNumber}</td>
            <td class="${record.status === 'Returned' ? 'status-returned' : ''}">${record.status || 'Active'}</td>
            <td class="no-print">
                ${record.status !== 'Returned' ? `
                    <button class="edit-btn" onclick="editRecord('${record.id}')">Edit</button>
                    <button class="return-btn" onclick="markAsReturned('${record.id}')">Return</button>
                    <button class="delete-btn" onclick="deleteRecord('${record.id}')">Delete</button>
                ` : ''}
            </td>
        </tr>
    `).join('');
}

// Check Departures
function checkDepartures() {
    const today = new Date().toISOString().split('T')[0];
    const departingToday = records.filter(record => 
        record.departureDate === today && record.status !== 'Returned'
    );

    const departuresDiv = document.getElementById('todayDepartures');
    const departuresList = document.getElementById('departuresList');

    if (departingToday.length > 0) {
        departuresDiv.style.display = 'block';
        departuresList.innerHTML = departingToday.map(record => `
            <div class="departure-item">
                <div>Room ${record.roomNumber} - ${record.guestName} (Bicycle #${record.bicycleNumber})</div>
                <button class="return-btn" onclick="markAsReturned('${record.id}')">Mark as Returned</button>
            </div>
        `).join('');
    } else {
        departuresDiv.style.display = 'none';
    }
}

// Document Ready
document.addEventListener('DOMContentLoaded', () => {
    // Initialize PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
    
    // Load initial data
    loadRecords();
    loadFaultyBicycles();
    
    // Set today's date as default for issue date
    const issueDateInput = document.getElementById('issueDate');
    if (issueDateInput) {
        issueDateInput.valueAsDate = new Date();
    }
});
</script>
<script>
// Arrival Preparation Component
const ArrivalPreparation = () => {
    const [arrivals, setArrivals] = React.useState([]);
    const [uploadError, setUploadError] = React.useState('');
    const [isLoading, setIsLoading] = React.useState(false);
    const [uploadedFile, setUploadedFile] = React.useState(null);

    const handleFileUpload = async (event) => {
        const file = event.target.files[0];
        if (!file || file.type !== 'application/pdf') {
            setUploadError('Please upload a PDF file');
            return;
        }

        setIsLoading(true);
        setUploadError('');

        try {
            // Upload to Firebase Storage
            const downloadURL = await uploadPDF(file);
            
            // Process PDF content
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let extractedText = '';

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                extractedText += textContent.items.map(item => item.str).join(' ');
            }

            // Parse extracted text for arrivals
            const parsedArrivals = parseArrivalData(extractedText);
            
            // Store in Firestore
            await storeArrivalRequests(parsedArrivals, downloadURL);
            
            setArrivals(parsedArrivals);
            showNotification('Arrival report processed successfully');
        } catch (error) {
            console.error('Error processing PDF:', error);
            setUploadError('Error processing PDF file');
        } finally {
            setIsLoading(false);
        }
    };

    const parseArrivalData = (text) => {
        // Your PDF parsing logic here
        // Return array of arrival objects
    };

    const storeArrivalRequests = async (arrivals, pdfUrl) => {
        const batch = db.batch();
        
        arrivals.forEach(arrival => {
            const docRef = db.collection('arrivalRequests').doc();
            batch.set(docRef, {
                ...arrival,
                pdfUrl,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        });

        await batch.commit();
    };

    return (
        <div className="arrival-preparation">
            {/* Upload Section */}
            <div className="pdf-upload">
                <input
                    type="file"
                    accept=".pdf"
                    onChange={handleFileUpload}
                    disabled={isLoading}
                />
                {uploadError && <div className="error">{uploadError}</div>}
                {isLoading && <div className="loading">Processing...</div>}
            </div>

            {/* Arrivals Table */}
            {arrivals.length > 0 && (
                <table>
                    <thead>
                        <tr>
                            <th>Room</th>
                            <th>Guest</th>
                            <th>Arrival</th>
                            <th>Departure</th>
                            <th>Bicycle Requests</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {arrivals.map(arrival => (
                            <tr key={arrival.id}>
                                <td>{arrival.roomNumber}</td>
                                <td>{arrival.guestName}</td>
                                <td>{arrival.arrivalDate}</td>
                                <td>{arrival.departureDate}</td>
                                <td>
                                    Adults: {arrival.bicycleRequest.adults}<br/>
                                    Children: {arrival.bicycleRequest.children}
                                </td>
                                <td>{arrival.status}</td>
                            </tr>
                        ))}
                    </tbody>
                </table>
            )}
        </div>
    );
};

// Initialize React components
const initializeReactComponents = () => {
    const arrivalRoot = ReactDOM.createRoot(document.getElementById('arrival-preparation-root'));
    arrivalRoot.render(React.createElement(ArrivalPreparation));
};

// Initialize everything when document is ready
document.addEventListener('DOMContentLoaded', () => {
    // Initialize Firebase
    try {
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
        
        // Load initial data
        Promise.all([
            loadRecords(),
            loadFaultyBicycles(),
        ]).then(() => {
            // Initialize React components
            initializeReactComponents();
            showNotification('System initialized successfully');
        });
    } catch (error) {
        console.error('Initialization error:', error);
        showNotification('Error initializing system', 'error');
    }
});
</script>
